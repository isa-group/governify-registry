id: SPU_IO_K01-Contract
version: "0.9.1"
type: agreement
context:
  provider: Accenture
  consumer: SAS
  validity:
    initial: "20141016"
    end: ""
  infrastructure:
    designer: "http://designer.sas.governify.io/"
    portal: "http://portal.sas.governify.io/v1/"
    registry: "http://registry.sas.governify.io/agreements/SPU"
  definitions:
    schemas:
      porcentajePTOT:
        description: Porcentaje de penalizacion sobre la facturacion mensual SPU
        type: double
        unit: "%"
      deadline:
        description: Plazo de resolucion de una inicidencia
        type: integer
        format: int32
        unit: hours
      schedule:
        description: Horario del servicio
        type: string
    scopes:
      SPU:
        priority:
          name: Prioridad
          description: Prioridad de la incidencia
          type: integer
          format: int32
          minimum: 1
          maximum: 3
        node:
          name: Nodo
          description: Provincia
          type: string
        nodeSize:
          description: SmallNode en Nodo < 20 ETCs y LargeNode en Nodo >= 20 ETCs.
          type: string
        center:
          name: Centro
          description: Centro
          type: string
        serviceLine:
          name: LineaServicio
          description: Linea de Servicio
          type: string
          default: "1. Linea servicio de mantenimiento básico"
        activity:
          name: Actividad
          description: Actividad
          type: string
          default: "1.1. Actividad de incidencias"
    logs:
      casdm:
        default: true
        uri: "http://logs.sas.governify.io/api/v10.12/ca-sdm"
        stateUri: "http://logs.sas.governify.io/api/v10.12/ca-sdm/count"
        scopes:
          SPU:
            priority: Prioridad
            node: Nodo
            center: Centro
      jira:
        uri: "http://jira.log.sas.governify.io"
        scopes:
          SPU:
            node: Nodo
terms:
  pricing:
    billing:
      period: "monthly"
      initial: "20160512T103536Z"
      penalties:
        - over:
            porcentajePTOT:
              $ref: "#/context/definitions/schemas/porcentajePTOT"
          aggegatedBy: sum
          groupBy:
            - $ref: "#/context/definitions/scopes/SPU/serviceLine"
            - $ref: "#/context/definitions/scopes/SPU/activity"
  metrics:
    issue_init:
      schema:
        description: Fecha de Inicio de incidencia
        type: date
    issue_end:
      schema:
        description: Fecha de Inicio de incidencia
        type: date
    issue_duration:
      schema:
        description: Duracion de una incidencia
        type: integer
        format: int32
        unit: hours
    SPU_IO_K00_evidence:
      schema:
        description: Penalización total
        type: bool
      parameters:
        deadline:
          schema:
            $ref: "#/context/definitions/schemas/deadline"
        schedule:
          schema:
            $ref: "#/context/definitions/schemas/schedule"
      scope:
        $ref: "#/context/definitions/scopes/SPU"
    SPU_IO_K00:
      schema:
        description: Penalizacion total del periodo
        type: double
      computer: "http://localhost:8081/api/v1/indicators/SPU_IO_K00/"
      scope:
        $ref: "#/context/definitions/scopes/SPU"
    SPU_IO_K01_evidence:
      schema:
        description: Incidencias resueltas en plazo
        type: bool
      parameters:
        deadline:
          schema:
            $ref: "#/context/definitions/schemas/deadline"
        schedule:
          schema:
            $ref: "#/context/definitions/schemas/schedule"
      scope:
        $ref: "#/context/definitions/scopes/SPU"
    SPU_IO_K01:
      schema:
        description: Porcentaje incidencias resueltas en plazo
        type: double
        unit: "%"
      computer: "http://localhost:8081/api/v1/indicators/SPU_IO_K01/"
      parameters:
        deadline:
          schema:
            $ref: "#/context/definitions/schemas/deadline"
        schedule:
          schema:
            $ref: "#/context/definitions/schemas/schedule"
      scope:
        $ref: "#/context/definitions/scopes/SPU"
  guarantees:
    - id: guarantee_SPU_IO_K01
      scope:
        priority:
          $ref: "#/context/definitions/scopes/SPU/priority"
        node:
          $ref: "#/context/definitions/scopes/SPU/node"
        serviceLine:
          $ref: "#/context/definitions/scopes/SPU/serviceLine"
        activity:
          $ref: "#/context/definitions/scopes/SPU/activity"
      of:
        - scope:
            priority: P3
            node: '*'
          objective: SPU_IO_K01 >= 95.00
          with:
            SPU_IO_K01:
              deadline: 2
              schedule: "L-DT00:00-23:59"
          window:
            type: static
            period: monthly
            initial: "20141016"
            end: ""
          evidences:
            - $ref: "#/terms/metrics/SPU_IO_K01_evidence"
            - $ref: "#/terms/metrics/issue_init"
            - $ref: "#/terms/metrics/issue_end"
            - $ref: "#/terms/metrics/issue_duration"
          penalties:
            - over:
                porcentajePTOT:
                  $ref: "#/context/definitions/schemas/porcentajePTOT"
              of:
                - value: "-2"
                  condition: "SPU_IO_K01 >= 90.00 && SPU_IO_K01 < 95.00"
                - value: "-3"
                  condition: "SPU_IO_K01 >= 85.00 && SPU_IO_K01 < 90.00"
                - value: "-5"
                  condition: "SPU_IO_K01 >= 0 && SPU_IO_K01 < 85.00"
        - scope:
            priority: P2
            node: '*'
          objective: SPU_IO_K01 >= 90.00
          with:
            SPU_IO_K01:
              deadline: 4
              schedule: "L-VT08:00-20:00"
          window:
            type: static
            period: monthly
            initial: "20141016"
            end: ""
          evidences:
            - $ref: "#/terms/metrics/SPU_IO_K01_evidence"
            - $ref: "#/terms/metrics/issue_init"
            - $ref: "#/terms/metrics/issue_end"
            - $ref: "#/terms/metrics/issue_duration"
          penalties:
            - over:
                porcentajePTOT:
                  $ref: "#/context/definitions/schemas/porcentajePTOT"
              of:
                - value: "-1.5"
                  condition: "SPU_IO_K01 >= 85.00 && SPU_IO_K01 < 90.00"
                - value: "-2"
                  condition: "SPU_IO_K01 >= 80.00 && SPU_IO_K01 < 85.00"
                - value: "-3"
                  condition: "SPU_IO_K01 >= 0 && SPU_IO_K01 < 80.00"
        - scope:
            priority: P1
            node: '*'
          objective: SPU_IO_K01 >= 82.50
          with:
            SPU_IO_K01:
              deadline: 17
              schedule: "L-VT08:00-20:00"
          window:
            type: static
            period: monthly
            initial: "20141016"
            end: ""
          evidences:
            - $ref: "#/terms/metrics/SPU_IO_K01_evidence"
            - $ref: "#/terms/metrics/issue_init"
            - $ref: "#/terms/metrics/issue_end"
            - $ref: "#/terms/metrics/issue_duration"
          penalties:
            - over:
                porcentajePTOT:
                  $ref: "#/context/definitions/schemas/porcentajePTOT"
              of:
                - value: "-0.75"
                  condition: "SPU_IO_K01 >= 77.50 && SPU_IO_K01 < 82.50"
                - value: "-1.25"
                  condition: "SPU_IO_K01 >= 72.50 && SPU_IO_K01 < 77.50"
                - value: "-1.75"
                  condition: "SPU_IO_K01 >= 0 && SPU_IO_K01 < 72.50"
